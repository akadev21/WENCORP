<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Majesty Project Form View -->
    <record id="view_majesty_commercial_project_form" model="ir.ui.view">
        <field name="name">majesty.projects.commercial.form</field>
        <field name="model">commercial.project</field>
        <field name="arch" type="xml">


            <form>
                <header>
                    <field name="state_commercial" widget="statusbar"/>
                    <!-- Button to send to designer -->
                    <button name="action_send_to_designer"
                            string="Envoyer au Designer"
                            type="object"
                            class="btn-primary"
                            invisible=" state_commercial != 'preparation'"/>

                    <!-- Button to validate designer -->
                    <button name="action_validate_design"
                            string="Valider Design"
                            type="object"
                            class="btn-primary"
                            invisible=" state_commercial != 'design_completed'"
                    />
                    <button name="action_invalidate_designer"
                            string="Design Non Valide"
                            type="object"
                            class="btn-secondary"
                            invisible=" state_commercial != 'design_completed'"
                    />
                </header>
                <field name="bat_cancel" invisible="1"/>
                <div class="alert alert-danger text-center o_form_header" role="status"
                     invisible=" bat_cancel != True">
                    <a class="close" data-dismiss="alert" href="#" aria-label="Close">x</a>
                    <div>
                        <strong>Raison de Refus :
                            <field name="invalidation_reason"/>
                        </strong>
                    </div>
                </div>
                <sheet>
                    <div class="oe_title">
                        <h1 class="d-flex flex-row">
                            <field name="is_favorite" nolabel="1" widget="boolean_favorite" class="me-2"/>
                            <field name="reference" options="{'line_breaks': False}" widget="text"
                                   class="o_text_overflow" readonly="1"/>
                        </h1>
                    </div>
                    <group style="margin-top: 50px;">


                        <group>

                            <field name="project" string="Nom du Projet"/>
                            <field name="sale_order_id" string="BC" invisible=" state_commercial != 'bc'"/>
                            <field name="client" string="Client" options="{'no_create': True}"/>
                            <field name="devis" string="Référence du Devis" widget="binary"
                                   filename="devis_filename"/>
                            <field name="devis_filename" string="Devis"
                                   invisible="1"/>

                            <field name="devis_url" widget="url" string="Devis Url Sallsy"/>
                            <field name="bat_cancel" invisible="1"/>
                            <field name="bat_validated" invisible="1"/>
                        </group>

                        <group>
                            <field name="designer" string="Designer"/>
                            <field name="designer_assign_date" string="Date d'Attribution du Designer" readonly="1"/>
                            <field name="bat" string="BAT" widget="binary" readonly="1" filename="bat_filename"

                            />
                            <field name="bat_filename" invisible="1"

                            />


                        </group>
                        <lable>Description</lable>
                        <field name="description" string="Description"/>
                        <lable>Commentaire Designer</lable>
                        <field name="comment" string="Commentaire Designer" readonly="1"/>
                    </group>

                    <notebook>
                        <page string="Documents Projet">
                            <field name="document_ids" create="Ajouter une ligne">
                                <tree editable="bottom">
                                    <field name="document_binary" widget="binary" filename="document_name"
                                           string="Document"/>
                                    <field name="document_name" string="Nom du document"/>


                                </tree>
                            </field>
                        </page>
                        <!-- Tab for Products -->
                        <page string="Liste des Articles">
                            <field name="product_ids">
                                <tree editable="bottom">
                                    <field name="project_id" column_invisible="1"/>
                                    <field name="product_id"/>
                                    <field name="description_sale"/>
                                    <field name="quantity"/>
                                    <field name="gender"/>
                                    <field name="customizable"/>
                                    <field name="model_design" string="Design"  widget="image" class="oe_avatar"
                                           filename="model_design_filename"/>
                                    <field name="model_design_filename" column_invisible="1"/>

                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <!-- Tab for Documents -->

                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="view_majesty_commercial_project_tree" model="ir.ui.view">
        <field name="name">majesty.project.commercial.tree</field>
        <field name="model">commercial.project</field>
        <field name="arch" type="xml">
            <!-- Add fields before and after the display_name field -->
            <tree>
                <field name="reference"/>
                <field name="project"/>
                <field name="client"/>
                <field name="creation_date"/>
                <field name="state_commercial"/>

                <!-- Hide unnecessary fields -->
            </tree>
        </field>


    </record>
    <!--    view kanban-->
    <record id="view_commercial_project_kanban" model="ir.ui.view">
        <field name="name">commercial.project.kanban</field>
        <field name="model">commercial.project</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_dashboard o_emphasize_colors"
                    default_group_by="state_commercial"
                    default_order="is_favorite desc, reference"
                    quick_create="false"
                    records_draggable="true">
                <!-- Define fields from the model -->
                <field name="state_commercial"/>
                <field name="project"/>
                <field name="reference"/>
                <field name="client"/>
                <field name="designer"/>
                <field name="creation_date"/>
                <field name="is_favorite"/>


                <templates>
                    <!-- Menu Template -->
                    <t t-name="kanban-menu">
                        <div class="container">
                            <div class="row">
                                <div class="col-6 o_kanban_card_manage_section o_kanban_manage_view">
                                    <h5 role="menuitem" class="o_kanban_card_manage_title">
                                        <span>Voir</span>
                                    </h5>
                                    <div role="menuitem">
                                        <a name="action_view_tasks" type="object">Documents</a>
                                    </div>
                                </div>
                                <div class="col-6 o_kanban_card_manage_section o_kanban_manage_reporting">
                                    <h5 role="menuitem" class="o_kanban_card_manage_title">
                                        <span>Actions</span>
                                    </h5>

                                </div>
                            </div>
                        </div>
                    </t>

                    <!-- Card Template -->
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_global_click o_has_icon oe_kanban_content oe_kanban_card">
                            <!-- Main Content -->
                            <div class="o_project_kanban_main d-flex align-items-baseline gap-1">
                                <field name="is_favorite" widget="boolean_favorite" nolabel="1" force_save="1"/>
                                <div class="o_kanban_card_content mw-100">
                                    <div class="o_kanban_primary_left">
                                        <div class="o_primary me-5">
                                            <!-- Reference and Project Name -->
                                            <span class="o_text_overflow" t-att-title="record.reference.value">
                                                <t t-esc="record.reference.value"/>
                                                <t t-if="record.project.value">-
                                                    <t t-esc="record.project.value"/>
                                                </t>
                                            </span>

                                            <!-- Client Info -->
                                            <span t-if="record.client.value" class="o_text_overflow text-muted">
                                                <span class="fa fa-user me-2" aria-label="Client" title="Client"/>
                                                <t t-esc="record.client.value"/>
                                            </span>

                                            <!-- Creation Date -->
                                            <div t-if="record.creation_date.value" class="text-muted o_row">
                                                <span class="fa fa-calendar me-2" title="Date"/>
                                                <field name="creation_date"/>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bottom Section -->
                            <div class="o_kanban_record_bottom mt-3">
                                <div class="oe_kanban_bottom_left d-flex align-items-center">
                                    <!-- Designer -->
                                    <div t-if="record.designer.value" class="me-3">
                                        <span class="fa fa-paint-brush me-1" aria-label="Designer" title="Designer"/>
                                        <field name="designer"/>
                                    </div>
                                    <!-- Commercial -->

                                </div>
                                <div class="oe_kanban_bottom_right">
                                    <field name="state_commercial" widget="label_selection"
                                           options="{'classes': {
                                           'preparation': 'default',
                                           'design_in_progress': 'info',
                                           'design_completed': 'success',
                                           'bc': 'warning'}}"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="view_commercial_project_filter" model="ir.ui.view">
        <field name="name">mrp.commercial.project.search</field>
        <field name="model">commercial.project</field>
        <field name="arch" type="xml">
            <search>
                <!-- Filter by Manufacturing Order (OF) -->
                <separator/>


                <field name="state_commercial" string="État"/>

                <!-- Grouping options -->
                <group>
                    <filter string="État" name="group_by_state" context="{'group_by':'state_commercial'}"/>

                </group>
            </search>
        </field>
    </record>


    <!-- Action for the menu -->
    <record id="action_majesty_project" model="ir.actions.act_window">
        <field name="name">Projets</field>
        <field name="res_model">commercial.project</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="context">{'search_default_group_by_state':1}</field>

    </record>

    <!-- Menu for Majesty Projects -->
    <menuitem id="menu_majesty_commercial_project"
              name="Projets"
              action="action_majesty_project"
              parent="menu_root_commercial"
              sequence="1"/>

    <!-- Sequence for project reference -->
    <record id="seq_project_reference_fix_new" model="ir.sequence">
        <field name="name">Project Reference</field>
        <field name="code">project.reference_fix_new</field>
        <field name="prefix">PRO-%(year)s%(month)s%(day)s-</field>
        <field name="padding">4</field>
        <field name="number_next">1</field>
        <field name="implementation">standard</field>
    </record>
</odoo>
